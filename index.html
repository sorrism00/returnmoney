<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íšŒìˆ˜ê¸ˆ ê³„ì‚°ê¸°</title>

  <!-- PWA ê´€ë ¨ ë©”íƒ€ íƒœê·¸ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ê³„ì‚°ê¸°">
  <link rel="apple-touch-icon" sizes="180x180" href="https://placehold.co/180x180/0f172a/fff?text=CC">
  <meta name="theme-color" content="#0f172a">
  
  <!-- manifest.json íŒŒì¼ ë§í¬ -->
  <link rel="manifest" href="/manifest.json">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React & ReactDOM CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel CDN for JSX support -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* Prevent number input spin buttons */
    input[type='text'].no-spinner::-webkit-outer-spin-button,
    input[type='text'].no-spinner::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type='text'].no-spinner {
      -moz-appearance: textfield;
    }
  </style>
</head>
<body class="bg-slate-900">

<div id="root"></div>

<script type="text/babel">
  // í™”í ë‹¨ìœ„ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
  const denominations = [
    { name: 'ì˜¤ë§Œì›ê¶Œ', value: 50000, type: 'bill' },
    { name: 'ë§Œì›ê¶Œ', value: 10000, type: 'bill' },
    { name: 'ì˜¤ì²œì›ê¶Œ', value: 5000, type: 'bill' },
    { name: 'ì²œì›ê¶Œ', value: 1000, type: 'bill' },
    { name: 'ì˜¤ë°±ì›', value: 500, type: 'coin' },
    { name: 'ë°±ì›', value: 100, type: 'coin' },
    { name: 'ì˜¤ì‹­ì›', value: 50, type: 'coin' },
    { name: 'ì‹­ì›', value: 10, type: 'coin' },
  ];

  // ìˆ«ìë¥¼ í•œêµ­ í˜•ì‹(ì½¤ë§ˆ)ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
  const formatCurrency = (amount) => {
    return new Intl.NumberFormat('ko-KR').format(amount);
  };

  function App() {
    const { useState, useMemo, useEffect } = React;

    // ê° í™”í ë‹¨ìœ„ì˜ ìˆ˜ëŸ‰ì„ ì €ì¥í•˜ëŠ” ìƒíƒœ
    const [quantities, setQuantities] = useState(() =>
      denominations.reduce((acc, denom) => ({ ...acc, [denom.value]: '' }), {})
    );

    // ì…ë ¥ í•„ë“œ ë³€ê²½ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
    const handleInputChange = (value, denom) => {
      // ìˆ«ìê°€ ì•„ë‹Œ ë¬¸ìë¥¼ ì œê±°í•˜ê³  ë¹ˆ ë¬¸ìì—´ì„ 0ìœ¼ë¡œ ë³€í™˜
      const cleanValue = value.replace(/[^0-9]/g, '');
      setQuantities(prev => ({
        ...prev,
        [denom.value]: cleanValue
      }));
    };
    
    // ëª¨ë“  ì…ë ¥ í•„ë“œë¥¼ ì´ˆê¸°í™”í•˜ëŠ” í•¨ìˆ˜
    const handleReset = () => {
      setQuantities(
        denominations.reduce((acc, denom) => ({ ...acc, [denom.value]: '' }), {})
      );
    };

    // ê¸ˆì•¡ ê³„ì‚° (ìµœì í™”ë¥¼ ìœ„í•´ useMemo ì‚¬ìš©)
    const totals = useMemo(() => {
      let billTotal = 0;
      let coinTotal = 0;

      denominations.forEach(denom => {
        const quantity = parseInt(quantities[denom.value]) || 0;
        const amount = quantity * denom.value;
        
        if (denom.type === 'bill') {
          billTotal += amount;
        } else {
          coinTotal += amount;
        }
      });

      const grandTotal = billTotal + coinTotal;
      
      return { billTotal, coinTotal, grandTotal };
    }, [quantities]);

    // UI êµ¬ì„± ìš”ì†Œ ë Œë”ë§
    const renderItem = (denom) => (
      // Use flexbox for consistent horizontal alignment, fixing the width of elements
      <div key={denom.value} className="flex items-center justify-between py-2 border-b border-gray-300">
        <div className="flex-1 min-w-0 pr-2">
          <span className="text-gray-700 text-lg sm:text-base font-medium whitespace-nowrap overflow-hidden text-ellipsis">{denom.name}</span>
        </div>
        
        <div className="flex items-center space-x-2 flex-shrink-0">
          <input
            type="text"
            inputMode="numeric"
            placeholder="0"
            value={quantities[denom.value]}
            onChange={(e) => handleInputChange(e.target.value, denom)}
            className="w-20 text-right text-gray-800 text-lg sm:text-base font-bold bg-gray-200 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none [-moz-appearance:_textfield] [&::-webkit-inner-spin-button]:m-0 [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:m-0 [&::-webkit-outer-spin-button]:appearance-none"
          />
          <span className="text-gray-500 text-sm hidden sm:inline">ê°œ</span>
        </div>

        <div className="flex items-center justify-end w-[100px] sm:w-[120px] ml-4 flex-shrink-0">
          <span className="font-semibold text-lg sm:text-base text-gray-900 whitespace-nowrap overflow-hidden text-ellipsis">
            {formatCurrency((parseInt(quantities[denom.value]) || 0) * denom.value)}
          </span>
        </div>
      </div>
    );

    return (
      <div className="min-h-screen bg-slate-900 font-sans flex flex-col items-center">
        <div className="w-full max-w-md bg-slate-100 rounded-2xl shadow-xl p-6 sm:p-8 space-y-4 transform transition-all duration-300">
          <div className="flex justify-between items-center mb-4">
            <h1 className="text-3xl sm:text-2xl font-extrabold text-gray-800 pb-2">
              íšŒìˆ˜ê¸ˆ ê³„ì‚°ê¸°
            </h1>
            <button
              onClick={handleReset}
              className="px-4 py-2 bg-slate-700 text-white font-bold rounded-lg shadow-md hover:bg-slate-600 transition-colors duration-200"
            >
              ì´ˆê¸°í™”
            </button>
          </div>

          {/* ì§€í ì„¹ì…˜ */}
          <div className="bg-white rounded-xl p-4 shadow-md border border-gray-200">
            <h2 className="text-xl sm:text-lg font-bold text-gray-800 mb-2">ğŸ’µ ì§€í</h2>
            {denominations.filter(d => d.type === 'bill').map(renderItem)}
            <div className="mt-4 pt-4 border-t-2 border-dashed border-gray-300 flex justify-between items-center font-bold text-lg sm:text-base text-gray-800">
              <span>ì§€í ì†Œê³„:</span>
              <span>{formatCurrency(totals.billTotal)}</span>
            </div>
          </div>

          {/* ë™ì „ ì„¹ì…˜ */}
          <div className="bg-white rounded-xl p-4 shadow-md border border-gray-200">
            <h2 className="text-xl sm:text-lg font-bold text-gray-800 mb-2">ğŸª™ ë™ì „</h2>
            {denominations.filter(d => d.type === 'coin').map(renderItem)}
            <div className="mt-4 pt-4 border-t-2 border-dashed border-gray-300 flex justify-between items-center font-bold text-lg sm:text-base text-gray-800">
              <span>ë™ì „ ì†Œê³„:</span>
              <span>{formatCurrency(totals.coinTotal)}</span>
            </div>
          </div>

          {/* ì´ê³„ ì„¹ì…˜ */}
          <div className="bg-slate-800 rounded-xl p-4 shadow-lg text-white">
            <div className="flex justify-between items-center">
              <h2 className="text-2xl sm:text-xl font-bold">í•©ê³„</h2>
              <span className="text-3xl sm:text-2xl font-extrabold text-amber-300">
                {formatCurrency(totals.grandTotal)}
              </span>
            </div>
          </div>
        </div>
      </div>
    );
  }

  // Render the App
  const container = document.getElementById('root');
  const root = ReactDOM.createRoot(container);
  root.render(<App />);
</script>

<script>
  // Service Worker Registration
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js').then(registration => {
        console.log('SW registered: ', registration);
      }).catch(registrationError => {
        console.log('SW registration failed: ', registrationError);
      });
    });
  }
</script>

<!-- Inline manifest.json for a single file -->
<script type="application/json" id="manifest">
{
  "name": "íšŒìˆ˜ê¸ˆ ê³„ì‚°ê¸°",
  "short_name": "ê³„ì‚°ê¸°",
  "description": "ê°„ë‹¨í•œ íšŒìˆ˜ê¸ˆ ê³„ì‚°ê¸°",
  "start_url": ".",
  "display": "standalone",
  "background_color": "#0f172a",
  "theme_color": "#0f172a",
  "icons": [
    {
      "src": "https://placehold.co/192x192/0f172a/fff?text=CC",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "https://placehold.co/512x512/0f172a/fff?text=CC",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
</script>

<!-- Inline service worker for a single file -->
<script id="sw-script">
  self.addEventListener('install', (event) => {
    event.waitUntil(
      caches.open('currency-calculator-v1').then((cache) => {
        return cache.addAll([
          '/',
          '/index.html',
          'https://unpkg.com/react@18/umd/react.production.min.js',
          'https://unpkg.com/react-dom@18/umd/react-dom.production.min.js',
          'https://unpkg.com/@babel/standalone/babel.min.js',
          'https://cdn.tailwindcss.com',
        ]);
      })
    );
    self.skipWaiting();
  });

  self.addEventListener('fetch', (event) => {
    event.respondWith(
      caches.match(event.request).then((response) => {
        return response || fetch(event.request);
      })
    );
  });
</script>
<script>
  // Dynamic SW file creation
  const swCode = document.getElementById('sw-script').textContent;
  const manifest = document.getElementById('manifest').textContent;
  
  const swBlob = new Blob([swCode], { type: 'application/javascript' });
  const manifestBlob = new Blob([manifest], { type: 'application/json' });

  const swUrl = URL.createObjectURL(swBlob);
  const manifestUrl = URL.createObjectURL(manifestBlob);
  
  const originalRegister = navigator.serviceWorker.register;
  const originalFetch = window.fetch;

  // Polyfill service worker registration
  navigator.serviceWorker.register = (path) => {
    if (path === '/sw.js') {
      return originalRegister.call(navigator.serviceWorker, swUrl);
    }
    return originalRegister.call(navigator.serviceWorker, path);
  };
  
  // Polyfill manifest fetch
  window.fetch = (input, init) => {
    if (input instanceof Request && input.url.endsWith('/manifest.json')) {
      return new Response(manifest, {
        headers: { 'Content-Type': 'application/json' }
      });
    } else if (typeof input === 'string' && input.endsWith('/manifest.json')) {
      return new Response(manifest, {
        headers: { 'Content-Type': 'application/json' }
      });
    }
    return originalFetch.call(window, input, init);
  };
  
</script>

</body>
</html>
