<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <!-- viewport-fit=cover ì¶”ê°€: ì•„ì´í° ë…¸ì¹˜ ì˜ì—­ê¹Œì§€ ë°°ê²½ í™•ì¥ -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>íšŒìˆ˜ê¸ˆ ê³„ì‚°ê¸°</title>

  <!-- PWA ê´€ë ¨ ë©”íƒ€ íƒœê·¸ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <!-- ìƒíƒœë°” ìŠ¤íƒ€ì¼: ë°°ê²½ê³¼ ìì—°ìŠ¤ëŸ½ê²Œ ì–´ìš°ëŸ¬ì§€ë„ë¡ ì„¤ì • -->
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ê³„ì‚°ê¸°">
  
  <link rel="apple-touch-icon" sizes="180x180" href="/returnmoney/icon-180x180.png">
  <meta name="theme-color" content="#0f172a">

  <link rel="icon" type="image/png" href="/returnmoney/icon-192x192.png">
  <link rel="manifest" href="/returnmoney/manifest.json">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React & ReactDOM CDN -->
  <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <!-- Babel CDN -->
  <script src="https://unpkg.com/@babel/standalone/babel.js"></script>

  <style>
    /* ì „ì²´ í™”ë©´ ë†’ì´ ì„¤ì • ë° ìƒí•˜ë‹¨ í…ì…˜(ê³ ë¬´ì¤„) íš¨ê³¼ ì œê±° */
    html, body {
      height: 100%;
      background-color: #0f172a;
      overscroll-behavior-y: none;
    }

    /* ìˆ«ì ì…ë ¥ ìŠ¤í”¼ë„ˆ ì œê±° */
    input[type='text'].no-spinner::-webkit-outer-spin-button,
    input[type='text'].no-spinner::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type='text'].no-spinner {
      -moz-appearance: textfield;
    }
  </style>
</head>
<body class="bg-slate-900 select-none"> <!-- select-none: í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ -->

<div id="root" class="h-full"></div>

<script type="text/babel">
  const denominations = [
    { name: 'ì˜¤ë§Œì›ê¶Œ', value: 50000, type: 'bill' },
    { name: 'ë§Œì›ê¶Œ', value: 10000, type: 'bill' },
    { name: 'ì˜¤ì²œì›ê¶Œ', value: 5000, type: 'bill' },
    { name: 'ì²œì›ê¶Œ', value: 1000, type: 'bill' },
    { name: 'ì˜¤ë°±ì›', value: 500, type: 'coin' },
    { name: 'ë°±ì›', value: 100, type: 'coin' },
    { name: 'ì˜¤ì‹­ì›', value: 50, type: 'coin' },
    { name: 'ì‹­ì›', value: 10, type: 'coin' },
  ];

  const formatCurrency = (amount) => {
    return new Intl.NumberFormat('ko-KR').format(amount);
  };

  function App() {
    const { useState, useMemo } = React;

    const [quantities, setQuantities] = useState(() =>
      denominations.reduce((acc, denom) => ({
        ...acc,
        [denom.value]: { count: '', amountInput: '' }
      }), {})
    );

    const [closingVaultAmount, setClosingVaultAmount] = useState('');
    const [coinReplenishmentAmount, setCoinReplenishmentAmount] = useState('');
    const [increaseAmount, setIncreaseAmount] = useState('');
    const [decreaseAmount, setDecreaseAmount] = useState('');

    const handleQuantityChange = (value, denom) => {
      const cleanValue = value.replace(/[^0-9]/g, '');
      const calculatedAmount = (parseInt(cleanValue) || 0) * denom.value;

      setQuantities(prev => ({
        ...prev,
        [denom.value]: {
          count: cleanValue,
          amountInput: String(calculatedAmount === 0 && cleanValue === '' ? '' : calculatedAmount)
        }
      }));
    };

    const handleAmountChange = (value, denom) => {
      const cleanValue = value.replace(/[^0-9]/g, '');
      const amount = parseInt(cleanValue) || 0;

      if (denom.value === 0) {
        setQuantities(prev => ({
          ...prev,
          [denom.value]: { count: '', amountInput: '' }
        }));
        return;
      }

      const calculatedQuantity = Math.floor(amount / denom.value);

      setQuantities(prev => ({
        ...prev,
        [denom.value]: {
          count: cleanValue === '' ? '' : String(calculatedQuantity),
          amountInput: cleanValue
        }
      }));
    };

    const handleClosingVaultAmountChange = (e) => setClosingVaultAmount(e.target.value.replace(/[^0-9]/g, ''));
    const handleCoinReplenishmentChange = (e) => setCoinReplenishmentAmount(e.target.value.replace(/[^0-9]/g, ''));
    const handleIncreaseChange = (e) => setIncreaseAmount(e.target.value.replace(/[^0-9]/g, ''));
    const handleDecreaseChange = (e) => setDecreaseAmount(e.target.value.replace(/[^0-9]/g, ''));

    const handleReset = () => {
      setQuantities(
        denominations.reduce((acc, denom) => ({
          ...acc,
          [denom.value]: { count: '', amountInput: '' }
        }), {})
      );
      setClosingVaultAmount('');
      setCoinReplenishmentAmount('');
      setIncreaseAmount('');
      setDecreaseAmount('');
    };

    const totals = useMemo(() => {
      let billTotal = 0;
      let coinTotal = 0;

      denominations.forEach(denom => {
        const quantity = parseInt(quantities[denom.value].count) || 0;
        const amount = quantity * denom.value;

        if (denom.type === 'bill') {
          billTotal += amount;
        } else {
          coinTotal += amount;
        }
      });

      const grandTotal = billTotal + coinTotal;

      const parsedClosingVaultAmount = parseInt(closingVaultAmount) || 0;
      const parsedCoinReplenishmentAmount = parseInt(coinReplenishmentAmount) || 0;
      const parsedIncreaseAmount = parseInt(increaseAmount) || 0;
      const parsedDecreaseAmount = parseInt(decreaseAmount) || 0;

      const postClosingVaultAmount =
        parsedClosingVaultAmount +
        grandTotal -
        parsedCoinReplenishmentAmount +
        parsedIncreaseAmount -
        parsedDecreaseAmount;

      return { billTotal, coinTotal, grandTotal, postClosingVaultAmount };
    }, [quantities, closingVaultAmount, coinReplenishmentAmount, increaseAmount, decreaseAmount]);

    const renderItem = (denom) => {
      const { count, amountInput } = quantities[denom.value];

      return (
        <div key={denom.value} className="flex items-center justify-between py-0.5 border-b border-gray-300">
          <div className="flex-1 pr-1">
            <span className="text-gray-700 text-sm font-medium whitespace-nowrap overflow-hidden text-ellipsis">{denom.name}</span>
          </div>

          <div className="flex items-center space-x-1 flex-shrink-0">
            <input
              type="text"
              inputMode="numeric"
              placeholder="0"
              value={count}
              onChange={(e) => handleQuantityChange(e.target.value, denom)}
              className="w-16 h-7 text-right text-gray-800 text-sm font-bold bg-gray-200 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
            />
            <span className="text-gray-500 text-xs">ê°œ</span>
          </div>

          <div className="flex-1 flex items-center justify-end ml-2">
            <input
              type="text"
              inputMode="numeric"
              placeholder="0"
              value={amountInput === '' ? '' : formatCurrency(parseInt(amountInput) || 0)}
              onChange={(e) => handleAmountChange(e.target.value, denom)}
              className="w-28 h-7 text-right text-gray-800 text-sm font-bold bg-gray-200 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
            />
          </div>
        </div>
      );
    };

    // Safe Area(ì•ˆì „ ì˜ì—­) íŒ¨ë”© ìŠ¤íƒ€ì¼: ë…¸ì¹˜ì™€ í•˜ë‹¨ ë°”ì— ë‚´ìš©ì´ ê°€ë ¤ì§€ì§€ ì•Šê²Œ í•¨
    const safeAreaStyle = {
      paddingTop: 'env(safe-area-inset-top)',
      paddingBottom: 'env(safe-area-inset-bottom)'
    };

    return (
      <div 
        className="w-full h-full bg-slate-900 font-sans flex flex-col items-center justify-center overflow-auto"
        style={safeAreaStyle}
      >
        <div className="w-full max-w-sm bg-slate-100 rounded-2xl shadow-xl p-2 space-y-1 transform transition-all duration-300">
          <div className="flex justify-between items-center mb-1">
            <h1 className="text-xl font-extrabold text-gray-800 pb-1">
              íšŒìˆ˜ê¸ˆ ê³„ì‚°ê¸°
            </h1>
            <button
              onClick={handleReset}
              className="px-3 py-1 bg-slate-700 text-white font-bold text-sm rounded-lg shadow-md hover:bg-slate-600 transition-colors duration-200"
            >
              ì´ˆê¸°í™”
            </button>
          </div>

          <div className="bg-slate-800 rounded-xl p-2 shadow-lg text-white mb-2">
            <div className="flex justify-between items-center">
              <h2 className="text-base font-bold">ë§ˆê° ì „ ê¸ˆê³  ê¸ˆì•¡</h2>
              <input
                type="text"
                inputMode="numeric"
                placeholder="0"
                value={closingVaultAmount === '' ? '' : formatCurrency(parseInt(closingVaultAmount) || 0)}
                onChange={handleClosingVaultAmountChange}
                className="w-36 h-7 text-right text-white text-base font-extrabold bg-slate-800 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
              />
            </div>
          </div>

          <div className="bg-white rounded-xl p-1 shadow-md border border-gray-200">
            {denominations.filter(d => d.type === 'bill').map(renderItem)}
            <div className="mt-1 pt-1 flex justify-between items-center font-bold text-sm text-gray-800">
              <span>ğŸ’µ ì§€í ì†Œê³„:</span>
              <span>{formatCurrency(totals.billTotal)}</span>
            </div>
          </div>

          <div className="bg-white rounded-xl p-1 shadow-md border border-gray-200">
            {denominations.filter(d => d.type === 'coin').map(renderItem)}
            <div className="mt-1 pt-1 flex justify-between items-center font-bold text-sm text-gray-800">
              <span>ğŸª™ ë™ì „ ì†Œê³„:</span>
              <span>{formatCurrency(totals.coinTotal)}</span>
            </div>
          </div>

          <div className="bg-slate-800 rounded-xl p-2 shadow-lg text-white">
            <div className="flex justify-between items-center">
              <h2 className="text-base font-bold">í•©ê³„</h2>
              <span className="text-lg font-extrabold text-amber-300">
                {formatCurrency(totals.grandTotal)}
              </span>
            </div>
          </div>

          <div className="flex justify-between space-x-1 mt-1">
            <div className="bg-red-700 rounded-xl p-2 shadow-lg text-white flex-1">
              <h2 className="text-sm font-bold mb-1">(-) ë™ì „ë³´ì¶©</h2>
              <input
                type="text"
                inputMode="numeric"
                placeholder="0"
                value={coinReplenishmentAmount === '' ? '' : formatCurrency(parseInt(coinReplenishmentAmount) || 0)}
                onChange={handleCoinReplenishmentChange}
                className="w-full h-7 text-right text-white text-sm font-bold bg-red-700 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
              />
            </div>

            <div className="bg-blue-700 rounded-xl p-2 shadow-lg text-white flex-1">
              <h2 className="text-sm font-bold mb-1">(+) ì¦ì•¡</h2>
              <input
                type="text"
                inputMode="numeric"
                placeholder="0"
                value={increaseAmount === '' ? '' : formatCurrency(parseInt(increaseAmount) || 0)}
                onChange={handleIncreaseChange}
                className="w-full h-7 text-right text-white text-sm font-bold bg-blue-700 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
              />
            </div>

            <div className="bg-red-700 rounded-xl p-2 shadow-lg text-white flex-1">
              <h2 className="text-sm font-bold mb-1">(-) ê°ì•¡</h2>
              <input
                type="text"
                inputMode="numeric"
                placeholder="0"
                value={decreaseAmount === '' ? '' : formatCurrency(parseInt(decreaseAmount) || 0)}
                onChange={handleDecreaseChange}
                className="w-full h-7 text-right text-white text-sm font-bold bg-red-700 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none"
              />
            </div>
          </div>

          <div className="bg-slate-800 rounded-xl p-2 shadow-lg text-white mt-1">
            <div className="flex justify-between items-center">
              <h2 className="text-base font-bold">ë§ˆê° í›„ ê¸ˆê³  ê¸ˆì•¡</h2>
              <span className="text-lg font-extrabold text-amber-300">
                {formatCurrency(totals.postClosingVaultAmount)}
              </span>
            </div>
          </div>

        </div>
      </div>
    );
  }

  const container = document.getElementById('root');
  const root = ReactDOM.createRoot(container);
  root.render(<App />);
</script>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/returnmoney/sw.js').then(registration => {
        console.log('SW registered: ', registration);
      }).catch(registrationError => {
        console.log('SW registration failed: ', registrationError);
      });
    });
  }
</script>

</body>
</html>
