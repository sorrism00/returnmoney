<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>íšŒìˆ˜ê¸ˆ ê³„ì‚°ê¸°</title>

  <!-- PWA ê´€ë ¨ ë©”íƒ€ íƒœê·¸ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ê³„ì‚°ê¸°">
  <!-- ì—…ë¡œë“œëœ ì´ë¯¸ì§€ íŒŒì¼ URLë¡œ ë³€ê²½ -->
  <link rel="apple-touch-icon" sizes="180x180" href="https://placehold.co/180x180/0f172a/fff?text=CC">
  <meta name="theme-color" content="#0f172a">

  <!-- Favicon ë§í¬ ì¶”ê°€ -->
  <link rel="icon" type="image/png" href="https://placehold.co/180x180/0f172a/fff?text=CC">

  <!-- manifest.json íŒŒì¼ ë§í¬ -->
  <link rel="manifest" href="/returnmoney/manifest.json">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React & ReactDOM CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react.production.min.js"></script>
  <!-- Babel CDN for JSX support -->
  <script src="https://unpkg.com/@babel/standalone/babel.js"></script>

  <style>
    /* Prevent number input spin buttons */
    input[type='text'].no-spinner::-webkit-outer-spin-button,
    input[type='text'].no-spinner::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type='text'].no-spinner {
      -moz-appearance: textfield;
    }
  </style>
</head>
<body class="bg-slate-900">

<div id="root"></div>

<script type="text/babel">
  // í™”í ë‹¨ìœ„ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. (í° ë‹¨ìœ„ë¶€í„° ì‘ì€ ë‹¨ìœ„ ìˆœìœ¼ë¡œ ì •ë ¬ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤)
  const denominations = [
    { name: 'ì˜¤ë§Œì›ê¶Œ', value: 50000, type: 'bill' },
    { name: 'ë§Œì›ê¶Œ', value: 10000, type: 'bill' },
    { name: 'ì˜¤ì²œì›ê¶Œ', value: 5000, type: 'bill' },
    { name: 'ì²œì›ê¶Œ', value: 1000, type: 'bill' },
    { name: 'ì˜¤ë°±ì›', value: 500, type: 'coin' },
    { name: 'ë°±ì›', value: 100, type: 'coin' },
    { name: 'ì˜¤ì‹­ì›', value: 50, type: 'coin' },
    { name: 'ì‹­ì›', value: 10, type: 'coin' },
  ];

  // ìˆ«ìë¥¼ í•œêµ­ í˜•ì‹(ì½¤ë§ˆ)ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
  const formatCurrency = (amount) => {
    return new Intl.NumberFormat('ko-KR').format(amount);
  };

  function App() {
    const { useState, useMemo } = React;

    // ê° í™”í ë‹¨ìœ„ì˜ ìˆ˜ëŸ‰ê³¼ ê¸ˆì•¡ ì…ë ¥ê°’ì„ ì €ì¥í•˜ëŠ” ìƒíƒœ
    const [quantities, setQuantities] = useState(() =>
      denominations.reduce((acc, denom) => ({
        ...acc,
        [denom.value]: { count: '', amountInput: '' } // countì™€ amountInputì„ ê°ì²´ë¡œ ì €ì¥
      }), {})
    );

    // ìƒˆë¡œìš´ ìƒíƒœ: ë§ˆê° ì „ ê¸ˆê³  ê¸ˆì•¡
    const [closingVaultAmount, setClosingVaultAmount] = useState('');
    // ìƒˆë¡œìš´ ìƒíƒœ: ë™ì „ ë³´ì¶© ê¸ˆì•¡
    const [coinReplenishmentAmount, setCoinReplenishmentAmount] = useState('');
    // ìƒˆë¡œìš´ ìƒíƒœ: ì¦ì•¡ ê¸ˆì•¡
    const [increaseAmount, setIncreaseAmount] = useState('');
    // ìƒˆë¡œìš´ ìƒíƒœ: ê°ì•¡ ê¸ˆì•¡
    const [decreaseAmount, setDecreaseAmount] = useState('');


    // ê°œìˆ˜ ì…ë ¥ í•„ë“œ ë³€ê²½ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
    const handleQuantityChange = (value, denom) => {
      const cleanValue = value.replace(/[^0-9]/g, ''); // ìˆ«ìë§Œ í—ˆìš©
      const calculatedAmount = (parseInt(cleanValue) || 0) * denom.value;

      setQuantities(prev => ({
        ...prev,
        [denom.value]: {
          count: cleanValue, // ê°œìˆ˜ ìƒíƒœ ì—…ë°ì´íŠ¸
          amountInput: String(calculatedAmount === 0 && cleanValue === '' ? '' : calculatedAmount) // ê¸ˆì•¡ ì…ë ¥ê°’ë„ ê°œìˆ˜ì— ë§ì¶° ì—…ë°ì´íŠ¸ (ì´ˆê¸°í™” ì‹œ ë¹ˆ ë¬¸ìì—´ ì²˜ë¦¬)
        }
      }));
    };

    // ê¸ˆì•¡ ì…ë ¥ í•„ë“œ ë³€ê²½ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
    const handleAmountChange = (value, denom) => {
      // ì…ë ¥ëœ ê°’ì—ì„œ ìˆ«ì ì´ì™¸ì˜ ë¬¸ì (ì½¤ë§ˆ í¬í•¨) ì œê±°
      const cleanValue = value.replace(/[^0-9]/g, '');
      const amount = parseInt(cleanValue) || 0;

      if (denom.value === 0) { // 0ìœ¼ë¡œ ë‚˜ëˆ„ëŠ” ê²½ìš° ë°©ì§€ (í™”í ë‹¨ìœ„ì— 0ì€ ì—†ì§€ë§Œ ë°©ì–´ì½”ë“œ)
        setQuantities(prev => ({
          ...prev,
          [denom.value]: { count: '', amountInput: '' }
        }));
        return;
      }

      // ì…ë ¥ëœ ê¸ˆì•¡ì— í•´ë‹¹í•˜ëŠ” ê°œìˆ˜ ê³„ì‚° (ì†Œìˆ˜ì  ë²„ë¦¼)
      const calculatedQuantity = Math.floor(amount / denom.value);

      setQuantities(prev => ({
        ...prev,
        [denom.value]: {
          count: cleanValue === '' ? '' : String(calculatedQuantity), // ê°œìˆ˜ ìƒíƒœ ì—…ë°ì´íŠ¸
          amountInput: cleanValue // ê¸ˆì•¡ ì…ë ¥ê°’ì€ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê·¸ëŒ€ë¡œ ìœ ì§€ (í¬ë§·ë˜ì§€ ì•Šì€ ìˆ«ì ë¬¸ìì—´)
        }
      }));
    };

    // ë§ˆê° ì „ ê¸ˆê³  ê¸ˆì•¡ ì…ë ¥ í•„ë“œ ë³€ê²½ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
    const handleClosingVaultAmountChange = (e) => {
      const value = e.target.value.replace(/[^0-9]/g, ''); // ìˆ«ìë§Œ í—ˆìš©
      setClosingVaultAmount(value);
    };

    // ë™ì „ ë³´ì¶© ê¸ˆì•¡ ì…ë ¥ í•„ë“œ ë³€ê²½ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
    const handleCoinReplenishmentChange = (e) => {
      const value = e.target.value.replace(/[^0-9]/g, '');
      setCoinReplenishmentAmount(value);
    };

    // ì¦ì•¡ ê¸ˆì•¡ ì…ë ¥ í•„ë“œ ë³€ê²½ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
    const handleIncreaseChange = (e) => {
      const value = e.target.value.replace(/[^0-9]/g, '');
      setIncreaseAmount(value);
    };

    // ê°ì•¡ ê¸ˆì•¡ ì…ë ¥ í•„ë“œ ë³€ê²½ì„ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
    const handleDecreaseChange = (e) => {
      const value = e.target.value.replace(/[^0-9]/g, '');
      setDecreaseAmount(value);
    };


    // ëª¨ë“  ì…ë ¥ í•„ë“œë¥¼ ì´ˆê¸°í™”í•˜ëŠ” í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€ëœ í•„ë“œ í¬í•¨)
    const handleReset = () => {
      setQuantities(
        denominations.reduce((acc, denom) => ({
          ...acc,
          [denom.value]: { count: '', amountInput: '' }
        }), {})
      );
      setClosingVaultAmount('');
      setCoinReplenishmentAmount('');
      setIncreaseAmount('');
      setDecreaseAmount('');
    };

    // ê¸ˆì•¡ ê³„ì‚° (ìµœì í™”ë¥¼ ìœ„í•´ useMemo ì‚¬ìš©)
    const totals = useMemo(() => {
      let billTotal = 0;
      let coinTotal = 0;

      denominations.forEach(denom => {
        // ì´ê³„ ê³„ì‚° ì‹œì—ëŠ” 'count' ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
        const quantity = parseInt(quantities[denom.value].count) || 0;
        const amount = quantity * denom.value;

        if (denom.type === 'bill') {
          billTotal += amount;
        } else {
          coinTotal += amount;
        }
      });

      const grandTotal = billTotal + coinTotal;

      // ë§ˆê° í›„ ê¸ˆê³  ê¸ˆì•¡ ê³„ì‚°
      const parsedClosingVaultAmount = parseInt(closingVaultAmount) || 0;
      const parsedCoinReplenishmentAmount = parseInt(coinReplenishmentAmount) || 0;
      const parsedIncreaseAmount = parseInt(increaseAmount) || 0;
      const parsedDecreaseAmount = parseInt(decreaseAmount) || 0;

      const postClosingVaultAmount =
        parsedClosingVaultAmount +
        grandTotal -
        parsedCoinReplenishmentAmount +
        parsedIncreaseAmount -
        parsedDecreaseAmount;


      return {
        billTotal,
        coinTotal,
        grandTotal,
        postClosingVaultAmount
      };
    }, [quantities, closingVaultAmount, coinReplenishmentAmount, increaseAmount, decreaseAmount]); // ëª¨ë“  ê´€ë ¨ ìƒíƒœë¥¼ ì˜ì¡´ì„± ë°°ì—´ì— ì¶”ê°€

    // UI êµ¬ì„± ìš”ì†Œ ë Œë”ë§
    const renderItem = (denom) => {
      const { count, amountInput } = quantities[denom.value]; // countì™€ amountInputì„ ë¶„ë¦¬í•˜ì—¬ ì‚¬ìš©

      return (
        <div key={denom.value} className="flex items-center justify-between py-1 border-b border-gray-300">
          <div className="flex-1 pr-1">
            <span className="text-gray-700 text-sm font-medium whitespace-nowrap overflow-hidden text-ellipsis">{denom.name}</span>
          </div>

          <div className="flex items-center space-x-1 flex-shrink-0">
            {/* ê°œìˆ˜ ì…ë ¥ í•„ë“œ */}
            <input
              type="text"
              inputMode="numeric"
              placeholder="0"
              value={count} // count ìƒíƒœ ì‚¬ìš©
              onChange={(e) => handleQuantityChange(e.target.value, denom)}
              className="w-16 h-8 text-right text-gray-800 text-sm font-bold bg-gray-200 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none [-moz-appearance:_textfield] [&::-webkit-inner-spin-button]:m-0 [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:m-0 [&::-webkit-outer-spin-button]:appearance-none"
            />
            <span className="text-gray-500 text-xs">ê°œ</span>
          </div>

          <div className="flex-1 flex items-center justify-end ml-2">
            {/* ê¸ˆì•¡ ì…ë ¥ í•„ë“œ */}
            <input
              type="text"
              inputMode="numeric"
              placeholder="0"
              // amountInputì„ í¬ë§·í•˜ì—¬ í‘œì‹œ. ë¹ˆ ë¬¸ìì—´ì¼ ê²½ìš° ê·¸ëŒ€ë¡œ ë¹ˆ ë¬¸ìì—´
              value={amountInput === '' ? '' : formatCurrency(parseInt(amountInput) || 0)}
              onChange={(e) => handleAmountChange(e.target.value, denom)}
              className="w-28 h-8 text-right text-gray-800 text-sm font-bold bg-gray-200 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none [-moz-appearance:_textfield] [&::-webkit-inner-spin-button]:m-0 [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:m-0 [&::-webkit-outer-spin-button]:appearance-none"
            />
          </div>
        </div>
      );
    };

    return (
      // ì»¨í…Œì´ë„ˆê°€ í™”ë©´ ì „ì²´ ë†’ì´ë¥¼ ì°¨ì§€í•˜ë„ë¡ min-h-screenì„ ì‚¬ìš©í•˜ê³ , flex-colë¡œ ì½˜í…ì¸ ë¥¼ ì¤‘ì•™ì— ë°°ì¹˜í•©ë‹ˆë‹¤.
      <div className="min-h-screen bg-slate-900 font-sans flex flex-col items-center justify-center">
        {/* ì „ì²´ ì»¨í…Œì´ë„ˆëŠ” max-w-smìœ¼ë¡œ ì œí•œí•˜ì—¬ PC í™”ë©´ì—ì„œ ë„ˆë¬´ ì»¤ì§€ì§€ ì•Šê²Œ í•©ë‹ˆë‹¤. */}
        <div className="w-full max-w-sm bg-slate-100 rounded-2xl shadow-xl p-4 space-y-2 transform transition-all duration-300">
          <div className="flex justify-between items-center mb-2">
            {/* íƒ€ì´í‹€ ê¸€ì í¬ê¸° ì¶•ì†Œ */}
            <h1 className="text-xl font-extrabold text-gray-800 pb-1">
              íšŒìˆ˜ê¸ˆ ê³„ì‚°ê¸°
            </h1>
            {/* ë²„íŠ¼ í¬ê¸° ì¶•ì†Œ */}
            <button
              onClick={handleReset}
              className="px-3 py-1 bg-slate-700 text-white font-bold text-sm rounded-lg shadow-md hover:bg-slate-600 transition-colors duration-200"
            >
              ì´ˆê¸°í™”
            </button>
          </div>

          {/* ë§ˆê° ì „ ê¸ˆê³  ê¸ˆì•¡ ì„¹ì…˜ */}
          <div className="bg-slate-800 rounded-xl p-3 shadow-lg text-white mb-4">
            <div className="flex justify-between items-center">
              <h2 className="text-lg font-bold">ë§ˆê° ì „ ê¸ˆê³  ê¸ˆì•¡</h2>
              <input
                type="text"
                inputMode="numeric"
                placeholder="0"
                value={closingVaultAmount === '' ? '' : formatCurrency(parseInt(closingVaultAmount) || 0)}
                onChange={handleClosingVaultAmountChange}
                // ë°°ê²½ìƒ‰ì„ ë¶€ëª¨ ì„¹ì…˜ê³¼ ë™ì¼í•˜ê²Œ ë§ì¶¤
                className="w-36 h-8 text-right text-white text-lg font-extrabold bg-slate-800 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none [-moz-appearance:_textfield] [&::-webkit-inner-spin-button]:m-0 [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:m-0 [&::-webkit-outer-spin-button]:appearance-none"
              />
            </div>
          </div>

          {/* ì§€í ì„¹ì…˜ */}
          <div className="bg-white rounded-xl p-2 shadow-md border border-gray-200">
            {denominations.filter(d => d.type === 'bill').map(renderItem)}
            <div className="mt-2 pt-2 flex justify-between items-center font-bold text-sm text-gray-800">
              <span>ğŸ’µ ì§€í ì†Œê³„:</span>
              <span>{formatCurrency(totals.billTotal)}</span>
            </div>
          </div>

          {/* ë™ì „ ì„¹ì…˜ */}
          <div className="bg-white rounded-xl p-2 shadow-md border border-gray-200">
            {denominations.filter(d => d.type === 'coin').map(renderItem)}
            <div className="mt-2 pt-2 flex justify-between items-center font-bold text-sm text-gray-800">
              <span>ğŸª™ ë™ì „ ì†Œê³„:</span>
              <span>{formatCurrency(totals.coinTotal)}</span>
            </div>
          </div>

          {/* ì´ê³„ ì„¹ì…˜ */}
          <div className="bg-slate-800 rounded-xl p-3 shadow-lg text-white">
            <div className="flex justify-between items-center">
              <h2 className="text-lg font-bold">í•©ê³„</h2>
              <span className="text-xl font-extrabold text-amber-300">
                {formatCurrency(totals.grandTotal)}
              </span>
            </div>
          </div>

          {/* ìƒˆë¡œìš´ ì„¹ì…˜ 1: ë™ì „ ë³´ì¶© */}
          <div className="bg-slate-700 rounded-xl p-3 shadow-lg text-white mt-2">
            <div className="flex justify-between items-center">
              <h2 className="text-lg font-bold">(-) ë™ì „ë³´ì¶©</h2>
              <input
                type="text"
                inputMode="numeric"
                placeholder="0"
                value={coinReplenishmentAmount === '' ? '' : formatCurrency(parseInt(coinReplenishmentAmount) || 0)}
                onChange={handleCoinReplenishmentChange}
                className="w-36 h-8 text-right text-white text-lg font-extrabold bg-slate-700 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none [-moz-appearance:_textfield] [&::-webkit-inner-spin-button]:m-0 [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:m-0 [&::-::-webkit-outer-spin-button]:appearance-none"
              />
            </div>
          </div>

          {/* ìƒˆë¡œìš´ ì„¹ì…˜ 2: ì¦ì•¡ */}
          <div className="bg-slate-700 rounded-xl p-3 shadow-lg text-white mt-2">
            <div className="flex justify-between items-center">
              <h2 className="text-lg font-bold">(+) ì¦ì•¡</h2>
              <input
                type="text"
                inputMode="numeric"
                placeholder="0"
                value={increaseAmount === '' ? '' : formatCurrency(parseInt(increaseAmount) || 0)}
                onChange={handleIncreaseChange}
                className="w-36 h-8 text-right text-white text-lg font-extrabold bg-slate-700 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none [-moz-appearance:_textfield] [&::-webkit-inner-spin-button]:m-0 [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:m-0 [&::-webkit-outer-spin-button]:appearance-none"
              />
            </div>
          </div>

          {/* ìƒˆë¡œìš´ ì„¹ì…˜ 3: ê°ì•¡ */}
          <div className="bg-slate-700 rounded-xl p-3 shadow-lg text-white mt-2">
            <div className="flex justify-between items-center">
              <h2 className="text-lg font-bold">(-) ê°ì•¡</h2>
              <input
                type="text"
                inputMode="numeric"
                placeholder="0"
                value={decreaseAmount === '' ? '' : formatCurrency(parseInt(decreaseAmount) || 0)}
                onChange={handleDecreaseChange}
                className="w-36 h-8 text-right text-white text-lg font-extrabold bg-slate-700 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none [-moz-appearance:_textfield] [&::-webkit-inner-spin-button]:m-0 [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:m-0 [&::-webkit-outer-spin-button]:appearance-none"
              />
            </div>
          </div>

          {/* ë§ˆê° í›„ ê¸ˆê³  ê¸ˆì•¡ ì„¹ì…˜ */}
          <div className="bg-slate-800 rounded-xl p-3 shadow-lg text-white mt-2">
            <div className="flex justify-between items-center">
              <h2 className="text-lg font-bold">ë§ˆê° í›„ ê¸ˆê³  ê¸ˆì•¡</h2>
              <span className="text-xl font-extrabold text-amber-300">
                {formatCurrency(totals.postClosingVaultAmount)}
              </span>
            </div>
          </div>

        </div>
      </div>
    );
  }

  // Render the App
  const container = document.getElementById('root');
  const root = ReactDOM.createRoot(container);
  root.render(<App />);
</script>

<script>
  // Service Worker Registration (ê²½ë¡œ ìˆ˜ì •)
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/returnmoney/sw.js').then(registration => {
        console.log('SW registered: ', registration);
      }).catch(registrationError => {
        console.log('SW registration failed: ', registrationError);
      });
    });
  }
</script>

</body>
</html>
